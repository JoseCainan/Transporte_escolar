<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ROTA+ | Despesas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='despesas.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">ROTA+</div>
        <ul>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="#">Alunos</a></li>
            <li><a href="/veiculos">Veículos</a></li>
            <li><a href="#">Motorista</a></li>
            <li><a href="/rotas">Rotas</a></li>
            <li class="active"><a href="/despesas">Despesas</a></li>
            <li><a href="#">Configurações</a></li>
        </ul>
    </aside>

    <main class="content">
        <header class="topbar">
            <h1>Despesas</h1>
            <button class="btn-green">Soma das Despesas</button>
        </header>

        <div class="filters">
            <button>Data ⌄</button>
            <button>Rota ⌄</button>
            <button>Veículo ⌄</button>
            <button>Motorista ⌄</button>
            <button class="reset">⟲ Resetar Filtro</button>
        </div>

        <section class="container">
            <div class="lista">
                {% for d in despesas %}
                <div class="card {% if loop.first %}selected{% endif %}"
                     data-motorista="{{ d.motorista }}"
                     data-rota="{{ d.rota }}"
                     data-veiculo="{{ d.veiculo }}"
                     data-total="{{ d.total }}"
                     data-periodo="{{ d.periodo }}"
                     data-detalhes="{{ d.detalhes | join(', ') }}">
                    <h3>{{ d.motorista }} <span>Total R$ {{ d.total }}</span></h3>
                    <p>{{ d.rota }}</p>
                    <p>{{ d.veiculo }}</p>
                </div>
                {% endfor %}
            </div>

            <div class="detalhes">
                <div class="box">
                    <h3 id="desp-motorista">Selecione uma despesa</h3>
                    <p id="desp-veiculo"></p>
                    <p id="desp-periodo"></p>
                    <p><strong id="desp-total"></strong></p>
                    <button class="btn-yellow">Comprovantes</button>
                </div>

                <h2>Veículos</h2>
                <div id="desp-detalhes"></div>
            </div>
        </section>
    </main>

    <script>
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                document.getElementById('desp-motorista').textContent = card.dataset.motorista;
                document.getElementById('desp-veiculo').textContent = card.dataset.veiculo;
                document.getElementById('desp-periodo').textContent = card.dataset.periodo;
                document.getElementById('desp-total').textContent = "Total R$ " + card.dataset.total;

                const detalhes = card.dataset.detalhes ? card.dataset.detalhes.split(",") : [];
                const container = document.getElementById('desp-detalhes');
                container.innerHTML = "";
                detalhes.forEach(det => {
                    const box = document.createElement("div");
                    box.className = "box";
                    box.innerHTML = `<p>${det.trim()}</p>`;
                    container.appendChild(box);
                });
            });
        });
    </script>
</body>
</html>
