<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ROTA+ | Rotas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='rotas.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">ROTA+</div>
        <ul>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="#">Alunos</a></li>
            <li><a href="/veiculos">Veículos</a></li>
            <li><a href="#">Motorista</a></li>
            <li class="active"><a href="/rotas">Rotas</a></li>
            <li><a href="/despesas">Despesas</a></li>
            <li><a href="#">Configurações</a></li>
        </ul>
    </aside>

    <main class="content">
        <header class="topbar">
            <h1>Rotas</h1>
            <button id="btnAddRota" class="btn-green">Adicionar Rota +</button>
        </header>

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Adicionar Rota</h2>
                <form action="/adicionar_rota" method="POST" class="form-modal">
                    <label>Nome da Rota:</label>
                    <input type="text" name="nome" required>

                    <label>Itinerário:</label>
                    <input type="text" name="itinerario" required>

                    <label>Dias:</label>
                    <input type="text" name="dias" placeholder="Ex: Seg-Qua-Sex" required>

                    <label>Motorista:</label>
                    <input type="text" name="motorista" required>

                    <label>Nota:</label>
                    <textarea name="nota"></textarea>

                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" id="btnCancel">Cancelar</button>
                        <button type="submit" class="btn-green">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="searchbar">
            <input type="text" placeholder="Pesquise por: Local ou Motoristas">
        </div>

        <section class="container">
            <div class="lista">
                {% for rota in rotas %}
                <div class="card" 
                    data-nome="{{ rota.nome }}" 
                    data-itinerario="{{ rota.itinerario }}"
                    data-dias="{{ rota.dias }}"
                    data-motorista="{{ rota.motorista }}"
                    data-nota="{{ rota.nota }}">
                    <h3>{{ rota.nome }} <span class="dia">{{ rota.dias }}</span></h3>
                    <p>{{ rota.itinerario }}</p>
                    <p><strong>{{ rota.motorista }}</strong></p>
                </div>
                {% endfor %}
            </div>

            <div class="detalhes">
                <div class="mapa">
                    <img src="{{ url_for('static', filename='mapa_exemplo.png') }}" alt="Mapa da Rota">
                </div>
                <div class="info">
                    <h3 id="rota-nome">Selecione uma rota</h3>
                    <p id="rota-itinerario"></p>
                    <p><span class="dia" id="rota-dias"></span></p>
                    <p class="nota" id="rota-nota"></p>
                    <p><strong id="rota-motorista"></strong></p>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                document.getElementById('rota-nome').textContent = card.dataset.nome;
                document.getElementById('rota-itinerario').textContent = card.dataset.itinerario;
                document.getElementById('rota-dias').textContent = card.dataset.dias;
                document.getElementById('rota-motorista').textContent = card.dataset.motorista;
                document.getElementById('rota-nota').textContent = card.dataset.nota || "Sem observações.";
            });
        });

        const modal = document.getElementById("modal");
        const btn = document.getElementById("btnAddRota");
        const span = document.querySelector(".close");
        const cancelBtn = document.getElementById("btnCancel");

        btn.onclick = () => modal.style.display = "flex";
        span.onclick = () => modal.style.display = "none";
        cancelBtn.onclick = () => modal.style.display = "none";
        window.onclick = (event) => {
            if (event.target == modal) modal.style.display = "none";
        };
    </script>
</body>
</html>
